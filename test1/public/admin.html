<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Administración de Contactos | Port Saplaya Living</title>
    <!-- Incluye el CSS de Tailwind compilado -->
    <link rel="stylesheet" href="./style.css">
    <!-- Incluye Font Awesome si necesitas iconos -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body class="font-sans bg-gray-100 py-12">
    <div class="container mx-auto px-6">
        <div class="bg-white p-8 rounded-lg shadow-xl">
            <h1 class="text-3xl md:text-4xl font-bold text-center mb-10 text-gray-800">Mensajes de Contacto Recibidos</h1>

            <div id="loading" class="text-center text-gray-600 text-lg mb-4">
                <i class="fas fa-spinner fa-spin mr-2"></i> Cargando datos...
            </div>
            <div id="error-message" class="text-center text-red-600 text-lg mb-4 hidden">
                <i class="fas fa-exclamation-circle mr-2"></i> Error al cargar los datos.
            </div>

            <div id="contactsList" class="space-y-6">
                <!-- Los mensajes de contacto se cargarán aquí con JavaScript -->
            </div>

            <div id="no-messages" class="text-center text-gray-600 text-lg hidden mt-8">
                No hay mensajes de contacto recibidos.
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const loadingDiv = document.getElementById('loading');
            const errorMessageDiv = document.getElementById('error-message');
            const contactsListDiv = document.getElementById('contactsList');
            const noMessagesDiv = document.getElementById('no-messages');

            fetch('fetch_contacts.php')
                .then(response => {
                    if (!response.ok) {
                        throw new Error('Error de red: ' + response.statusText);
                    }
                    return response.json();
                })
                .then(data => {
                    loadingDiv.classList.add('hidden');

                    if (data.error) {
                        errorMessageDiv.textContent = 'Error del servidor: ' + data.error;
                        errorMessageDiv.classList.remove('hidden');
                        console.error('Server Error:', data.error);
                        return;
                    }

                    if (data.length === 0) {
                        noMessagesDiv.classList.remove('hidden');
                    } else {
                        data.forEach(contact => {
                            const contactCard = document.createElement('div');
                            contactCard.classList.add('bg-gray-50', 'p-6', 'rounded-lg', 'shadow-md', 'border', 'border-gray-200');

                            contactCard.innerHTML = `
                                <div class="flex justify-between items-center mb-4 border-b pb-4 border-gray-200">
                                    <h3 class="text-xl font-semibold text-blue-700">${contact.name}</h3>
                                    <span class="text-sm text-gray-500">ID: ${contact.id}</span>
                                </div>
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                                    <div>
                                        <p class="text-gray-700"><i class="fas fa-envelope mr-2 text-blue-500"></i><strong>Email:</strong> ${contact.email}</p>
                                        <p class="text-gray-700"><i class="fas fa-phone-alt mr-2 text-blue-500"></i><strong>Teléfono:</strong> ${contact.phone || 'No especificado'}</p>
                                    </div>
                                    <div>
                                        <p class="text-gray-700"><i class="fas fa-calendar-alt mr-2 text-blue-500"></i><strong>Fecha Preferente:</strong> ${contact.preferred_date || 'No especificada'}</p>
                                        <p class="text-gray-700"><i class="fas fa-clock mr-2 text-blue-500"></i><strong>Enviado:</strong> ${contact.submission_time}</p>
                                    </div>
                                </div>
                                <div class="mb-4">
                                    <p class="text-gray-700"><i class="fas fa-comment-dots mr-2 text-blue-500"></i><strong>Mensaje:</strong></p>
                                    <p class="bg-white p-4 rounded-md border border-gray-300 mt-2 text-gray-800 whitespace-pre-wrap">${contact.message || 'Sin mensaje'}</p>
                                </div>
                                <div class="text-sm text-gray-600">
                                    <i class="fas fa-check-circle mr-1 ${contact.privacy_consent == 1 ? 'text-green-500' : 'text-red-500'}"></i> Consentimiento de privacidad: ${contact.privacy_consent == 1 ? 'Aceptado' : 'No aceptado'}
                                </div>
                            `;
                            contactsListDiv.appendChild(contactCard);
                        });
                    }
                })
                .catch(error => {
                    loadingDiv.classList.add('hidden');
                    errorMessageDiv.textContent = 'Error al obtener los datos: ' + error.message;
                    errorMessageDiv.classList.remove('hidden');
                    console.error('Fetch Error:', error);
                });
        });
    </script>
</body>
</html>